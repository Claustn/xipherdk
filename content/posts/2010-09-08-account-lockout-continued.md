---
categories:
- Everyday
date: "2010-09-08T22:12:53Z"
meta:
  _edit_last: "1"
  _syntaxhighlighter_encoded: "1"
  _wp_old_slug: ""
  dsq_thread_id: "6227559079"
status: publish
tags: []
title: Account lockout continued
---
<p>I considered putting this in the script I wrote for checking Services/Scheduled Tasks/COM+ objects, but it just gave me too much output, so I decided to put this in a separate script, and tried to put a GUI around it, since it has been a while since I have opened Primal Forms.</p>
<p>The script takes a username, it then connects to all servers in your domain, and checks to see if the username you typed in has a connection to that server, it does so by querying Win32_LoggedOnUser (You will be surprised by how many connections you have to different machines)</p>
<p>The script requires Powershell V2, Quest AD cmdlets.</p>
<p>[sourcecode lang="Ps"]<br />
########################################################################<br />
# Code Generated By: SAPIEN Technologies, Inc., PrimalForms 2009 v1.1.9.0<br />
# Generated On: 08-09-2010 22:12<br />
# Generated By: CTN<br />
########################################################################</p>
<p>#----------------------------------------------<br />
#region Application Functions<br />
#----------------------------------------------</p>
<p>function OnApplicationLoad {<br />
	#Note: This function runs before the form is created<br />
	#Note: To get the script directory in the Packager use: Split-Path $hostinvocation.MyCommand.path<br />
	#Note: To get the console output in the Packager (Windows Mode) use: $ConsoleOutput (Type: System.Collections.ArrayList)<br />
	#Important: Form controls cannot be accessed in this function<br />
	#TODO: Add snapins and custom code to validate the application load</p>
<p>	return $true #return true for success or false for failure<br />
}</p>
<p>function OnApplicationExit {<br />
	#Note: This function runs after the form is closed<br />
	#TODO: Add custom code to clean up and unload snapins when the application exits</p>
<p>	$script:ExitCode = 0 #Set the exit code for the Packager<br />
}</p>
<p>#endregion</p>
<p>#----------------------------------------------<br />
# Generated Form Function<br />
#----------------------------------------------<br />
function GenerateForm {</p>
<p>	#----------------------------------------------<br />
	#region Import Assemblies<br />
	#----------------------------------------------<br />
	[void][reflection.assembly]::Load(&quot;System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)<br />
	[void][reflection.assembly]::Load(&quot;System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;)<br />
	[void][reflection.assembly]::Load(&quot;mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)<br />
	[void][reflection.assembly]::Load(&quot;System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;)<br />
	#endregion</p>
<p>	#----------------------------------------------<br />
	#region Generated Form Objects<br />
	#----------------------------------------------<br />
	[System.Windows.Forms.Application]::EnableVisualStyles()<br />
	$form1 = New-Object System.Windows.Forms.Form<br />
	$label5 = New-Object System.Windows.Forms.Label<br />
	$label4 = New-Object System.Windows.Forms.Label<br />
	$label3 = New-Object System.Windows.Forms.Label<br />
	$label2 = New-Object System.Windows.Forms.Label<br />
	$label1 = New-Object System.Windows.Forms.Label<br />
	$progressbar1 = New-Object System.Windows.Forms.ProgressBar<br />
	$listbox1 = New-Object System.Windows.Forms.ListBox<br />
	$CheckBTN = New-Object System.Windows.Forms.Button<br />
	$Usernametxt = New-Object System.Windows.Forms.TextBox<br />
	$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState<br />
	#endregion Generated Form Objects</p>
<p>	#----------------------------------------------<br />
	# User Generated Script<br />
	#----------------------------------------------</p>
<p>	$FormEvent_Load={<br />
		#TODO: Initialize Form Controls here</p>
<p>	}</p>
<p>	$handler_textbox1_TextChanged={<br />
	#TODO: Place custom script here</p>
<p>	}</p>
<p>	$handler_CheckBTN_Click={</p>
<p>	#TODO: Place custom script here<br />
	$i = 1<br />
	$ErrorActionPreference =&quot;silentlycontinue&quot;<br />
	 $Servers = get-QADComputer -SearchRoot 'appension.local/' -OSName &quot;*Server*&quot;</p>
<p>	 $progressbar1.Maximum(($Servers).length)<br />
	 $label2.Text = $servers.length</p>
<p>	 Foreach ($server in $Servers) {<br />
	 $users = get-WmiObject -computer $server.Name Win32_LoggedOnUser | select Antecedent -Unique<br />
	 $label4.Text = $i<br />
	 $i++<br />
	 $label5.Text = $Server.name<br />
	  $progressbar1.Increment(&quot;1&quot;)</p>
<p>	 Foreach ($user in $users) {</p>
<p>	$domainname =([regex]::Match($user.Antecedent, 'Domain=&quot;(?&lt;domain&gt;.*?)&quot;')).Groups[&quot;domain&quot;].Value<br />
	$username = ([regex]::Match($user.Antecedent, 'Name=&quot;(?&lt;name&gt;.*?)&quot;')).Groups[&quot;name&quot;].Value<br />
	If ($username -like $Usernametxt.Text) {<br />
	#Write-Host &quot;*************   $($server.name) ********************&quot;<br />
	$listbox1.Items.Add($Servers.name)<br />
	 }<br />
	 }<br />
	 }<br />
	}</p>
<p>	$handler_label1_Click={<br />
	#TODO: Place custom script here</p>
<p>	}</p>
<p>	$handler_listbox1_SelectedIndexChanged={<br />
	#TODO: Place custom script here</p>
<p>	}</p>
<p>	#----------------------------------------------<br />
	# Generated Events<br />
	#----------------------------------------------</p>
<p>	$Form_StateCorrection_Load=<br />
	{<br />
		#Correct the initial state of the form to prevent the .Net maximized form issue<br />
		$form1.WindowState = $InitialFormWindowState<br />
	}</p>
<p>	#----------------------------------------------<br />
	#region Generated Form Code<br />
	#----------------------------------------------<br />
	#<br />
	# form1<br />
	#<br />
	$form1.Controls.Add($label5)<br />
	$form1.Controls.Add($label4)<br />
	$form1.Controls.Add($label3)<br />
	$form1.Controls.Add($label2)<br />
	$form1.Controls.Add($label1)<br />
	$form1.Controls.Add($progressbar1)<br />
	$form1.Controls.Add($listbox1)<br />
	$form1.Controls.Add($CheckBTN)<br />
	$form1.Controls.Add($Usernametxt)<br />
	$form1.Text = &quot;Check where user is logged in.&quot;<br />
	$form1.Name = &quot;form1&quot;<br />
	$form1.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$form1.ClientSize = New-Object System.Drawing.Size(418,358)<br />
	$form1.add_Load($FormEvent_Load)<br />
	#<br />
	# label5<br />
	#<br />
	$label5.TabIndex = 8<br />
	$label5.Size = New-Object System.Drawing.Size(149,18)<br />
	$label5.Location = New-Object System.Drawing.Point(142,302)<br />
	$label5.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$label5.Name = &quot;label5&quot;<br />
	#<br />
	# label4<br />
	#<br />
	$label4.TabIndex = 7<br />
	$label4.Size = New-Object System.Drawing.Size(31,18)<br />
	$label4.Location = New-Object System.Drawing.Point(61,303)<br />
	$label4.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$label4.Name = &quot;label4&quot;<br />
	#<br />
	# label3<br />
	#<br />
	$label3.TabIndex = 6<br />
	$label3.Size = New-Object System.Drawing.Size(27,18)<br />
	$label3.Text = &quot;   of&quot;<br />
	$label3.Location = New-Object System.Drawing.Point(84,303)<br />
	$label3.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$label3.Name = &quot;label3&quot;<br />
	#<br />
	# label2<br />
	#<br />
	$label2.TabIndex = 5<br />
	$label2.Size = New-Object System.Drawing.Size(33,18)<br />
	$label2.Location = New-Object System.Drawing.Point(109,303)<br />
	$label2.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$label2.Name = &quot;label2&quot;<br />
	#<br />
	# label1<br />
	#<br />
	$label1.TabIndex = 4<br />
	$label1.Size = New-Object System.Drawing.Size(42,18)<br />
	$label1.Text = &quot;Server&quot;<br />
	$label1.Location = New-Object System.Drawing.Point(24,303)<br />
	$label1.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$label1.Name = &quot;label1&quot;<br />
	$label1.add_Click($handler_label1_Click)<br />
	#<br />
	# progressbar1<br />
	#<br />
	$progressbar1.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$progressbar1.Size = New-Object System.Drawing.Size(382,23)<br />
	$progressbar1.TabIndex = 3<br />
	$progressbar1.Location = New-Object System.Drawing.Point(24,323)<br />
	$progressbar1.Name = &quot;progressbar1&quot;<br />
	#<br />
	# listbox1<br />
	#<br />
	$listbox1.FormattingEnabled = $True<br />
	$listbox1.Size = New-Object System.Drawing.Size(201,225)<br />
	$listbox1.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$listbox1.Name = &quot;listbox1&quot;<br />
	$listbox1.Location = New-Object System.Drawing.Point(24,75)<br />
	$listbox1.TabIndex = 2<br />
	$listbox1.add_SelectedIndexChanged($handler_listbox1_SelectedIndexChanged)<br />
	#<br />
	# CheckBTN<br />
	#<br />
	$CheckBTN.TabIndex = 1<br />
	$CheckBTN.Name = &quot;CheckBTN&quot;<br />
	$CheckBTN.Size = New-Object System.Drawing.Size(75,23)<br />
	$CheckBTN.UseVisualStyleBackColor = $True<br />
	$CheckBTN.Text = &quot;Check&quot;<br />
	$CheckBTN.Location = New-Object System.Drawing.Point(150,20)<br />
	$CheckBTN.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$CheckBTN.add_Click($handler_CheckBTN_Click)<br />
	#<br />
	# Usernametxt<br />
	#<br />
	$Usernametxt.Size = New-Object System.Drawing.Size(100,20)<br />
	$Usernametxt.DataBindings.DefaultDataSourceUpdateMode = [System.Windows.Forms.DataSourceUpdateMode]::OnValidation<br />
	$Usernametxt.Text = &quot;Username&quot;<br />
	$Usernametxt.Name = &quot;Usernametxt&quot;<br />
	$Usernametxt.Location = New-Object System.Drawing.Point(24,24)<br />
	$Usernametxt.TabIndex = 0<br />
	$Usernametxt.add_TextChanged($handler_textbox1_TextChanged)<br />
	#endregion Generated Form Code</p>
<p>	#----------------------------------------------
#Save the initial state of the form  
 $InitialFormWindowState = $form1.WindowState  
 #Init the OnLoad event to correct the initial state of the form  
 $form1.add\_Load($Form\_StateCorrection\_Load)  
 #Show the Form  
 return $form1.ShowDialog()

} #End Function

#Call OnApplicationLoad to initialize  
if(OnApplicationLoad -eq $true)  
{  
 #Create the form  
 GenerateForm | Out-Null  
 #Perform cleanup  
 OnApplicationExit  
}  
[/sourcecode]

