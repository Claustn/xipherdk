<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.79.0" />

    
    
    

<title>The (r)evolution of a script • XenoBlog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The (r)evolution of a script"/>
<meta name="twitter:description" content="As those of you who a following my blog know, I have been fortunate enough to become a Microsoft MVP in Powershell, and because of that I have been allowed on the Powershell MVP mailing list, an let me tell, there are some amazing people out there, doing some amazing stuff."/>

<meta property="og:title" content="The (r)evolution of a script" />
<meta property="og:description" content="As those of you who a following my blog know, I have been fortunate enough to become a Microsoft MVP in Powershell, and because of that I have been allowed on the Powershell MVP mailing list, an let me tell, there are some amazing people out there, doing some amazing stuff." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2011-01-06-the-revolution-of-a-script/" />
<meta property="article:published_time" content="2011-01-06T23:58:53+00:00" />
<meta property="article:modified_time" content="2011-01-06T23:58:53+00:00" /><meta property="og:site_name" content="XenoBlog" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="/">
        
          XenoBlog
        
        </a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="/assets/images/me.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">XenoBlog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Portfolio</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>AboutMe</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/claustn" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://facebook.com/claus.t.nielsen.37" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/claustn" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/claustn" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	<a href="mailto:claustnspam@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2007 - 2020 Xenophane
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>The (r)evolution of a script</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 6, 2011
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/tech-stuff">TECH STUFF</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/powershell">powershell</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 9 min read
</div>


  </header>
  
  
  <div class="post">
    <p>As those of you who a following my blog know, I have been fortunate enough to become a Microsoft MVP in Powershell, and because of that I have been allowed on the Powershell MVP mailing list, an let me tell, there are some amazing people out there, doing some amazing stuff. Some of the stuff floating around I don&rsquo;t even have a clue what does ;)</p>
<p>But people are also very helpful, and quick to jump in if someone has a problem or even if someone just posts a piece of code they find useful, people tend to jump in with suggestions/additions to make the script even better&hellip; Here is an example of a script that went from 14 lines of code to 334 in half a day.</p>
<p>Tome Tanasovski wrote a quick and dirty script that connects to the MVP site, and cycles through all the categories, and returns how many MVP&rsquo;s there are in each. He ended off by saying, that the results where not entirely correct, since some MVP has hidden the profile from the public list, meaning you would have to be logged in to see them.</p>
<p>[ps]<br>
$web = New-Object System.Net.WebClient<br>
$regex = [regex]'(?m)&lt;a href=&quot;(/communities/mvp.aspx?product=1&amp;competency=(\S+))&quot;'<br>
$objects = @()<br>
$return = $web.DownloadString(&lsquo;<a href="http://mvp.support.microsoft.com/communities/mvp.aspx'">http://mvp.support.microsoft.com/communities/mvp.aspx'</a>)<br>
$regex.Matches($return) |% {<br>
$obj = New-Object psobject<br>
$obj |Add-Member NoteProperty -Name &lsquo;Group&rsquo; -Value ($_.Groups[2].Value -replace &lsquo;+&rsquo;,&rsquo; &lsquo;)<br>
if ($web.DownloadString((&lsquo;<a href="http://mvp.support.microsoft.com">http://mvp.support.microsoft.com</a>&rsquo; + $_.Groups[1].Value)) -match &lsquo;Results 1 - \d+ of (\d+)') {<br>
$obj |Add-Member NoteProperty -Name &lsquo;Count&rsquo; -Value ([int]$matches[1])<br>
}<br>
$objects += $obj<br>
}</p>
<p>$objects |sort Count -Descending |ogv<br>
[/ps]</p>
<p>So I decided to write some simple IE automation that would log you you on to the Microsoft passport site, and count all the MVP&rsquo;s, including those who do not have a public profile.</p>
<p>[ps]<br>
$URI = &ldquo;<a href="https://login.live.com/ppsecure/secure.srf?lc=1033&amp;sf=1&amp;id=259214&amp;ru=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;tw=0&amp;fs=0&amp;kv=0&amp;cb=wizid%3df4502d34-3b8f-4a04-b741-289e08aa1782%26lcid%3d1033%26returnurl%3dhttps%253a%252f%252fmvp.support.microsoft.com%252fcommunities%252fmvp.aspx%26brand%3dMicrosoft&amp;cbcxt=&amp;wp=MCMBI&amp;wa=wsignin1.0&amp;wreply=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;wlsu=1%22">https://login.live.com/ppsecure/secure.srf?lc=1033&amp;sf=1&amp;id=259214&amp;ru=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;tw=0&amp;fs=0&amp;kv=0&amp;cb=wizid%3df4502d34-3b8f-4a04-b741-289e08aa1782%26lcid%3d1033%26returnurl%3dhttps%253a%252f%252fmvp.support.microsoft.com%252fcommunities%252fmvp.aspx%26brand%3dMicrosoft&amp;cbcxt=&amp;wp=MCMBI&amp;wa=wsignin1.0&amp;wreply=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;wlsu=1&quot;</a><br>
$ie = new-object -com &ldquo;InternetExplorer.Application&rdquo;<br>
$ie.visible = $false<br>
$ie.navigate($URI)<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
$doc = $ie.Document<br>
$ie.Document.Body.InnerText.ToString()<br>
$user = $doc.getElementByID(&ldquo;Login&rdquo;)<br>
$user.value = &ldquo;xxxxxxxxxx&rdquo;<br>
$pass = $doc.getElementByID(&ldquo;Passwd&rdquo;)<br>
$pass.value = &ldquo;xxxxxxxxxx&rdquo;<br>
$Logon = $doc.getElementByID(&ldquo;SI&rdquo;)<br>
$Logon.click()<br>
while ($ie.LocationURL -ne &ldquo;<a href="https://mvp.support.microsoft.com/communities/mvp.aspx%22">https://mvp.support.microsoft.com/communities/mvp.aspx&quot;</a>) { Start-Sleep -Milliseconds 1000; }<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
#$ie.Document.Body.InnerHTML.ToString()</p>
<p>$regex = [regex]'(?m)&lt;A href=&quot;(/communities/mvp.aspx?product=1&amp;competency=(\S+))&quot;&rsquo;<br>
$objects = @()</p>
<p>$return = $ie.Document.Body.InnerHTML.ToString()</p>
<p>$regex.Matches($return)|% {<br>
$obj = New-Object psobject<br>
$obj |Add-Member NoteProperty -Name &lsquo;Group&rsquo; -Value ($_.Groups[2].Value -replace &lsquo;+&rsquo;,&rsquo; &lsquo;)<br>
$URI = &ldquo;<a href="https://mvp.support.microsoft.com">https://mvp.support.microsoft.com</a>$($_.Groups[1].Value -replace &lsquo;amp;&rsquo;,'')&rdquo;<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
$ie.navigate($URI)<br>
$URI<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
if (($ie.Document.Body.InnerText.ToString()) -match &lsquo;Results 1 - \d+ of (\d+)') {<br>
$MVPs=&quot;&quot;; $MVPs = [int]$matches[1];$MVPs; $obj |Add-Member NoteProperty -Name &lsquo;Count&rsquo; -Value ($MVPs)</p>
<p>}<br>
$objects += $obj<br>
}<br>
$objects |sort Count -Descending |ogv<br>
[/ps]</p>
<p>Then Michael B Smith jumped in on the thread, because he thought my script needed some error handling, which is completely right, and came up with his own version of the script.<br>
[ps]<br>
Param(<br>
[switch]$gridview,<br>
[string]$username,<br>
[string]$password<br>
)</p>
<p>[System.Reflection.Assembly]::LoadWithPartialName(&ldquo;System.Web&rdquo;) | out-null</p>
<p>$ie = $null</p>
<p>try<br>
{<br>
if ($username)<br>
{<br>
$URI = &ldquo;<a href="https://login.live.com/ppsecure/secure.srf?lc=1033&amp;sf=1&amp;id=259214&amp;ru=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;tw=0&amp;fs=0&amp;kv=0&amp;cb=wizid%3df4502d34-3b8f-4a04-b741-289e08aa1782%26lcid%3d1033%26returnurl%3dhttps%253a%252f%252fmvp.support.microsoft.com%252fcommunities%252fmvp.aspx%26brand%3dMicrosoft&amp;cbcxt=&amp;wp=MCMBI&amp;wa=wsignin1.0&amp;wreply=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;wlsu=1%22">https://login.live.com/ppsecure/secure.srf?lc=1033&amp;sf=1&amp;id=259214&amp;ru=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;tw=0&amp;fs=0&amp;kv=0&amp;cb=wizid%3df4502d34-3b8f-4a04-b741-289e08aa1782%26lcid%3d1033%26returnurl%3dhttps%253a%252f%252fmvp.support.microsoft.com%252fcommunities%252fmvp.aspx%26brand%3dMicrosoft&amp;cbcxt=&amp;wp=MCMBI&amp;wa=wsignin1.0&amp;wreply=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;wlsu=1&quot;</a><br>
$ie = new-object -com &ldquo;InternetExplorer.Application&rdquo;<br>
$ie.visible = $false<br>
$ie.navigate($URI)<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
$doc = $ie.Document<br>
$ie.Document.Body.InnerText.ToString()</p>
<p>$user = $doc.getElementById( &ldquo;i0116&rdquo; ) ## login<br>
if( $user )<br>
{<br>
$user.value = $username<br>
}<br>
else<br>
{<br>
&ldquo;Document element named &lsquo;Login&rsquo; not found&rdquo;<br>
}</p>
<p>$pass = $doc.getElementById( &ldquo;i0118&rdquo; ) ## passwd<br>
if( $pass )<br>
{<br>
$pass.value = $password<br>
}<br>
else<br>
{<br>
&ldquo;Document element named &lsquo;Passwd&rsquo; not found&rdquo;<br>
}</p>
<p>$Logon = $doc.getElementById( &ldquo;i0011&rdquo; ) ## SI<br>
if( $Logon )<br>
{<br>
$Logon.click()<br>
}<br>
else<br>
{<br>
&ldquo;Document element named &lsquo;SI&rsquo; not found&rdquo;<br>
}</p>
<p>$count = 0<br>
while( $ie.LocationURL -ne &ldquo;<a href="https://mvp.support.microsoft.com/communities/mvp.aspx%22">https://mvp.support.microsoft.com/communities/mvp.aspx&quot;</a> )<br>
{<br>
if( $ie.LocationURL -eq &ldquo;<a href="https://mvp.support.microsoft.com/mvpinvalidsignin.aspx%22">https://mvp.support.microsoft.com/mvpinvalidsignin.aspx&quot;</a> )<br>
{<br>
write-error &ldquo;Invalid username / password combination&rdquo;<br>
return<br>
}</p>
<p>Start-Sleep -Milliseconds 1000<br>
if( $count -gt 15 )<br>
{<br>
&ldquo;Location URL is $($ie.LocationURL)&rdquo;<br>
}<br>
$count++<br>
}</p>
<p>$count = 0<br>
while( $ie.Busy -eq $true )<br>
{<br>
Start-Sleep -Milliseconds 1000<br>
if( $count -gt 15 )<br>
{<br>
&ldquo;IE still busy after $count seconds&rdquo;<br>
}<br>
$count++<br>
}</p>
<p>#$ie.Document.Body.InnerHTML.ToString()<br>
}</p>
<p>$regex = [regex]'(?m)&lt;A href=&quot;(/communities/mvp.aspx?product=1&amp;competency=(\S+))&quot;&rsquo;<br>
$objects = @()</p>
<p>$return = $ie.Document.Body.InnerHTML.ToString()<br>
$regex.Matches($return)|% {<br>
$obj = New-Object psobject<br>
$obj |Add-Member NoteProperty -Name &lsquo;Group&rsquo; -Value ([System.Web.HttpUtility]::UrlDecode( $_.Groups[2].Value ))</p>
<p>$URI = &ldquo;<a href="https://mvp.support.microsoft.com">https://mvp.support.microsoft.com</a>$($_.Groups[1].Value -replace &lsquo;amp;&rsquo;,'')&rdquo;<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
$ie.navigate($URI)<br>
$URI<br>
while ($ie.Busy -eq $true) { Start-Sleep -Milliseconds 1000; }<br>
if (($ie.Document.Body.InnerText.ToString()) -match &lsquo;Results 1 - \d+ of (\d+)') {<br>
$MVPs=&quot;&quot;; $MVPs = [int]$matches[1];$MVPs; $obj |Add-Member NoteProperty -Name &lsquo;Count&rsquo; -Value ($MVPs)<br>
}<br>
$objects += $obj<br>
}</p>
<p>&quot; &quot;<br>
&ldquo;Total MVP Competencies $($objects.Count)&rdquo;<br>
if( $gridview )<br>
{<br>
$objects |sort Count -Descending |ogv<br>
}<br>
else<br>
{<br>
$objects |sort Count -Descending<br>
}</p>
<p>}<br>
finally<br>
{<br>
if( $ie )<br>
{<br>
$ie.Quit()<br>
$ie = $null<br>
}<br>
}</p>
<p>[/ps]</p>
<p>Finally Kirk Munro decided to go &ldquo;all in&rdquo; and more or less rewrite the entire script into reusable functions, and using PSCredentials for more secure handling of the password, rewrote the logic to speed up the script, made it possible to only check a single MVP group and lots more.</p>
<p>[ps]<br>
function Get-MvpCount {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$false)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String[]]<br>
$Competency = @('*'),</p>
<p>[Parameter(Mandatory=$false)]<br>
[ValidateRange(0,60)]<br>
[System.Int32]<br>
$Timeout = 15,</p>
<p>[Parameter(Mandatory=$false)]<br>
[ValidateNotNull()]<br>
[System.Management.Automation.Credential()]<br>
$Credential = [System.Management.Automation.PSCredential]::Empty<br>
)</p>
<p>#region Initialize and load helper module.<br>
$helperModule = New-Module -ScriptBlock {<br>
#region Initialize local variables.<br>
$ie = $null<br>
#endregion</p>
<p>function Show-IEWindow {<br>
#region Create a new hidden instance of Internet Explorer if one does not exist.<br>
if (-not $script:ie) {<br>
$script:ie = New-Object -ComObject &lsquo;InternetExplorer.Application&rsquo;<br>
}<br>
#endregion</p>
<p>#region Show the IE window.<br>
$script:ie.Visible = $true<br>
#endregion<br>
}</p>
<p>function Hide-IEWindow {<br>
#region Create a new hidden instance of Internet Explorer if one does not exist.<br>
if (-not $script:ie) {<br>
$script:ie = New-Object -ComObject &lsquo;InternetExplorer.Application&rsquo;<br>
}<br>
#endregion</p>
<p>#region Hide the IE window.<br>
$script:ie.Visible = $false<br>
#endregion<br>
}</p>
<p>function Open-IEWebSite {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String]<br>
$Uri,</p>
<p>[Parameter(Position=1,Mandatory=$false)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String[]]<br>
$ErrorUri,</p>
<p>[Parameter(Mandatory=$false)]<br>
[ValidateRange(0,60)]<br>
[System.Int32]<br>
$Timeout = 15<br>
)<br>
#region Create a new hidden instance of Internet Explorer if one does not exist.<br>
if (-not $script:ie) {<br>
$script:ie = New-Object -ComObject &lsquo;InternetExplorer.Application&rsquo;<br>
$script:ie.Visible = $false<br>
}<br>
#endregion</p>
<p>try {<br>
#region Navigate to the specified web site.<br>
Write-Progress -Activity &lsquo;Loading a web page&rsquo; -Status &ldquo;Loading $Uri&hellip;&rdquo;<br>
$script:ie.Navigate($Uri)<br>
#endregion</p>
<p>#region Wait until IE has finished loading the web site.<br>
$count = 0<br>
do {<br>
if ($Timeout -and ($count -gt ($Timeout * 1000))) {<br>
throw &ldquo;The $Uri web page failed to load in $Timeout seconds.&rdquo;<br>
}<br>
if ((-not $script:ie.Busy) -and $ErrorUri) {<br>
foreach ($failedLocationUrl in $ErrorUri) {<br>
if ($script:ie.LocationURL -like $failedLocationUrl) {<br>
throw &ldquo;The $Uri web page failed to load ($($script:ie.LocationURL)).&rdquo;<br>
}<br>
}<br>
}<br>
Start-Sleep -Milliseconds 500<br>
$count++<br>
} while ($script:ie.Busy)<br>
#endregion<br>
}<br>
finally {<br>
if ($script:ie.Busy) {<br>
$script:ie.Stop()<br>
}<br>
Write-Progress -Activity &lsquo;Loading a web page&rsquo; -Status &ldquo;Loading $Uri&hellip;&rdquo; -Completed<br>
}<br>
}<br>
function Test-IEWebSiteElement {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String]<br>
$Name<br>
)<br>
#region Raise an error if you haven&rsquo;t opened a web site yet.<br>
if (-not $script:ie.Document) {<br>
throw &lsquo;You must open a web site using Open-IEWebSite before you can invoke a button on the site.&rsquo;<br>
}<br>
#endregion</p>
<p>#region Return true if the element exists; false otherwise.<br>
[bool]$script:ie.Document.getElementById($Name)<br>
#endregion<br>
}</p>
<p>function Set-IEWebSiteFieldData {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.Collections.Hashtable]<br>
$DataMap<br>
)<br>
#region Raise an error if you haven&rsquo;t opened a web site yet.<br>
if (-not $script:ie.Document) {<br>
throw &lsquo;You must open a web site using Open-IEWebSite before you can set field data.&rsquo;<br>
}<br>
#endregion</p>
<p>#region Load the data into the appropriate fields.<br>
foreach ($key in $DataMap.Keys) {<br>
if ($field = $script:ie.Document.getElementById($key)) {<br>
$field.Value = $DataMap[$key]<br>
} else {<br>
throw &ldquo;Field element &lsquo;$key&rsquo; was not found on $($script:ie.LocationURL).&rdquo;<br>
}<br>
}<br>
#endregion<br>
}<br>
function Invoke-IEWebSiteButton {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String]<br>
$Name,</p>
<p>[Parameter(Position=1,Mandatory=$false)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String[]]<br>
$ErrorUri,</p>
<p>[Parameter(Mandatory=$false)]<br>
[ValidateRange(0,60)]<br>
[System.Int32]<br>
$Timeout = 15<br>
)<br>
#region Raise an error if you haven&rsquo;t opened a web site yet.<br>
if (-not $script:ie.Document) {<br>
throw &lsquo;You must open a web site using Open-IEWebSite before you can invoke a button on the site.&rsquo;<br>
}<br>
#endregion</p>
<p>try {<br>
#region Click on the specified button.<br>
Write-Progress -Activity &lsquo;Clicking a web site button&rsquo; -Status &ldquo;Clicking on the $Name button on $($script:ie.LocationURL)&hellip;&rdquo;<br>
if ($button = $script:ie.Document.getElementById($Name)) {<br>
$button.Click()<br>
} else {<br>
throw &ldquo;Button &lsquo;$Name&rsquo; was not found on $($script:ie.LocationURL).&rdquo;<br>
}<br>
#endregion</p>
<p>#region Wait until IE has finished loading the web site.<br>
$count = 0<br>
do {<br>
if ($Timeout -and ($count -gt ($Timeout * 1000))) {<br>
throw &ldquo;The web page failed to load in $Timeout seconds.&rdquo;<br>
}<br>
if ((-not $script:ie.Busy) -and $ErrorUri) {<br>
foreach ($failedLocationUrl in $ErrorUri) {<br>
if ($script:ie.LocationURL -like $failedLocationUrl) {<br>
throw &ldquo;An error occurred ($($script:ie.LocationURL)).&rdquo;<br>
}<br>
}<br>
}<br>
Start-Sleep -Milliseconds 500<br>
$count++<br>
} while ($script:ie.Busy)<br>
#endregion<br>
}<br>
finally {<br>
if ($script:ie.Busy) {<br>
$script:ie.Stop()<br>
}<br>
Write-Progress -Activity &lsquo;Clicking a web site button&rsquo; -Status &ldquo;Clicking on the $Name button on $($script:ie.LocationURL)&hellip;&rdquo; -Completed<br>
}<br>
}<br>
function Get-IEWebSiteMatch {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.Text.RegularExpressions.Regex[]]<br>
$Regex<br>
)<br>
#region Raise an error if you haven&rsquo;t opened a web site yet.<br>
if (-not $script:ie.Document) {<br>
throw &lsquo;You must open a web site using Open-IEWebSite before you can invoke a button on the site.&rsquo;<br>
}<br>
#endregion</p>
<p>#region Return all matches for the specified regular expression.<br>
$innerHtml = $script:ie.Document.Body.InnerHTML.ToString()<br>
foreach ($value in $RegEx) {<br>
$value.Matches($innerHtml)<br>
}<br>
#endregion<br>
}<br>
function ConvertFrom-EncodedUrl {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true,ValueFromPipeline=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String[]]<br>
$InputObject<br>
)<br>
begin {<br>
#region Load the System.Web assembly.<br>
[System.Reflection.Assembly]::LoadWithPartialName(&lsquo;System.Web&rsquo;) | Out-Null<br>
#endregion<br>
}<br>
process {<br>
#region Decode the values.<br>
foreach ($value in $InputObject) {<br>
[System.Web.HttpUtility]::UrlDecode($value)<br>
}<br>
#endregion<br>
}<br>
}</p>
<p>function ConvertTo-EncodedUrl {<br>
[CmdletBinding()]<br>
param(<br>
[Parameter(Position=0,Mandatory=$true,ValueFromPipeline=$true)]<br>
[ValidateNotNullOrEmpty()]<br>
[System.String[]]<br>
$InputObject<br>
)<br>
begin {<br>
#region Load the System.Web assembly.<br>
[System.Reflection.Assembly]::LoadWithPartialName(&lsquo;System.Web&rsquo;) | Out-Null<br>
#endregion<br>
}<br>
process {<br>
#region Encode the values.<br>
foreach ($value in $InputObject) {<br>
[System.Web.HttpUtility]::UrlEncode($value)<br>
}<br>
#endregion<br>
}<br>
}</p>
<p>$ExecutionContext.SessionState.Module.OnRemove = {<br>
if ($script:ie) {<br>
try {<br>
$script:ie.Quit()<br>
}<br>
finally {<br>
$script:ie = $null<br>
}<br>
}<br>
}<br>
}<br>
#endregion</p>
<p>#region Load the helper module.<br>
$helperModule | Import-Module<br>
#endregion</p>
<p>try {<br>
#region Open the MVP website, using credentials if they were provided.<br>
if ($Credential -and ($Credential -ne [System.Management.Automation.PSCredential]::Empty)) {<br>
#region If the caller provided credentials, use Passport login before retrieving competency data.<br>
Open-IEWebSite -Uri &lsquo;<a href="https://login.live.com/ppsecure/secure.srf?lc=1033&amp;sf=1&amp;id=259214&amp;ru=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;tw=0&amp;fs=0&amp;kv=0&amp;cb=wizid%3df4502d34-3b8f-4a04-b741-289e08aa1782%26lcid%3d1033%26returnurl%3dhttps%253a%252f%252fmvp.support.microsoft.com%252fcommunities%252fmvp.aspx%26brand%3dMicrosoft&amp;cbcxt=&amp;wp=MCMBI&amp;wa=wsignin1.0&amp;wreply=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;wlsu=1'">https://login.live.com/ppsecure/secure.srf?lc=1033&amp;sf=1&amp;id=259214&amp;ru=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;tw=0&amp;fs=0&amp;kv=0&amp;cb=wizid%3df4502d34-3b8f-4a04-b741-289e08aa1782%26lcid%3d1033%26returnurl%3dhttps%253a%252f%252fmvp.support.microsoft.com%252fcommunities%252fmvp.aspx%26brand%3dMicrosoft&amp;cbcxt=&amp;wp=MCMBI&amp;wa=wsignin1.0&amp;wreply=https://mvp.support.microsoft.com/communities/mvp.aspx&amp;wlsu=1'</a><br>
if (Test-IEWebSiteElement -Name &lsquo;i0011&rsquo;) {<br>
Set-IEWebSiteFieldData -DataMap @{<br>
&lsquo;i0116&rsquo; = $Credential.UserName.Trim([Char[]]&rsquo; ')<br>
&lsquo;i0118&rsquo; = $Credential.GetNetworkCredential().Password<br>
}<br>
Invoke-IEWebSiteButton -Name &lsquo;i0011&rsquo; -ErrorUri &lsquo;<a href="https://mvp.support.microsoft.com/mvpinvalidsignin.aspx'">https://mvp.support.microsoft.com/mvpinvalidsignin.aspx'</a><br>
}<br>
#endregion<br>
} else {<br>
#region Otherwise, simply open the MVP website.<br>
Open-IEWebSite -Uri &lsquo;<a href="https://mvp.support.microsoft.com/communities/mvp.aspx'">https://mvp.support.microsoft.com/communities/mvp.aspx'</a><br>
#endregion<br>
}<br>
#endregion</p>
<p>#region Process the compentencies that were requested.<br>
Get-IEWebSiteMatch -Regex &lsquo;(?m)&lt;A href=&quot;(/communities/mvp.aspx?product=1&amp;competency=(\S+))&quot;&rsquo; <code>| Add-Member -MemberType ScriptProperty -Name DecodedUrl -Value {$this.Groups[2].Value | ConvertFrom-EncodedUrl} -PassThru </code><br>
| Sort-Object -Property DecodedUrl <code>| ForEach-Object {   foreach ($value in $Competency) {   if ($\_.DecodedUrl -like $value) {   Open-IEWebSite -Uri &quot;https://mvp.support.microsoft.com$($\_.Groups[1].Value -replace 'amp;','')&quot;   if ($matches = Get-IEWebSiteMatch -Regex 'Results 1 \- \d+ of (\d+)') {   $competencyRecord = New-Object -TypeName System.Management.Automation.PSObject </code><br>
| Add-Member -MemberType NoteProperty -Name Competency -Value $_.DecodedUrl -PassThru `<br>
| Add-Member -MemberType NoteProperty -Name Count -Value $matches[0].Groups[1].Value -PassThru<br>
$competencyRecord.PSTypeNames.Insert(0,&lsquo;MVPCompetencyRecord&rsquo;)<br>
$competencyRecord<br>
}<br>
break<br>
}<br>
}<br>
}<br>
#endregion<br>
}<br>
finally {<br>
$helperModule | Remove-Module<br>
}<br>
}<br>
[/ps]</p>
<p><strong>Remember this is not thoroughly tested code, this is just examples of different ways of doing things&hellip;</strong></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/2011-01-04-mvp/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">MVP</span>
    </a>
    
    
    <a href="/posts/2011-01-14-free-online-source-control-with-powergui-pro/" class="navigation-next">
      <span class="navigation-tittle">Free online Source Control with PowerGui Pro.</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'xipher-1';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" integrity="sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/powershell.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/sql.min.js"></script>
            
        
    <script type="text/javascript">
        
        hljs.configure({languages: ["powershell, sql"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
