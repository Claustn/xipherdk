<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.79.0" />

    
    
    

<title>Deleting empty folders in Outlook • XenoBlog</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Deleting empty folders in Outlook"/>
<meta name="twitter:description" content="A friend of mine called me, and asked me for help&hellip; He had had a migration go wrong and had ended up with a bunch of .pst files containing 1000&rsquo;s of emtpy folders."/>

<meta property="og:title" content="Deleting empty folders in Outlook" />
<meta property="og:description" content="A friend of mine called me, and asked me for help&hellip; He had had a migration go wrong and had ended up with a bunch of .pst files containing 1000&rsquo;s of emtpy folders." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2009-03-30-deleting-empty-folders-in-outlook/" />
<meta property="article:published_time" content="2009-03-30T16:17:26+00:00" />
<meta property="article:modified_time" content="2009-03-30T16:17:26+00:00" /><meta property="og:site_name" content="XenoBlog" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="/">
        
          XenoBlog
        
        </a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="/assets/images/me.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">XenoBlog</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Portfolio</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>AboutMe</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/claustn" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://facebook.com/claus.t.nielsen.37" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/claustn" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/claustn" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	<a href="mailto:claustnspam@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2007 - 2020 Xenophane
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Deleting empty folders in Outlook</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Mar 30, 2009
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/everyday">EVERYDAY</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/exchange">exchange</a>
           
      
          <a class="badge badge-tag" href="/tags/folder">folder</a>
           
      
          <a class="badge badge-tag" href="/tags/mail">mail</a>
           
      
          <a class="badge badge-tag" href="/tags/outlook">outlook</a>
           
      
          <a class="badge badge-tag" href="/tags/powershell">powershell</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    <p>A friend of mine called me, and asked me for help&hellip; He had had a migration go wrong and had ended up with a bunch of .pst files containing 1000&rsquo;s of emtpy folders. He had started cleaning up the .pst&rsquo;s manually, after having spent several hours on one .pst file he decided on another approach, and this is where I came in.</p>
<p>He asked if it was possible to write a script that would delete all the empty folders for him, I said to him that I bet it is possible, just not sure if I can do it, I have never really &ldquo;scripted&rdquo; Outlook before..</p>
<p>So I started looking for ways to manipulate data in Outlook and found out that the Outlook.Application COM object allowed me to manipulate folders and messages within Outlook.. Did some quick testing, told my friend that it should be possible, and that I would get back to him&hellip;</p>
<p>After some mucking around here is what I ended up with.<br>
[ps]<br>
$olApp = new-object -com Outlook.Application<br>
$namespace = $olApp.GetNamespace(&ldquo;MAPI&rdquo;)<br>
#Root folder to match, look in your outlook and look at what folders you have.<br>
#RooFolders could be Mailbox - &lt;username&gt;, Public folders, or other mapped in PST&rsquo;s or mailboxes.<br>
$RootfolderToMatch = &ldquo;Inbox&rdquo;</p>
<p>$Global:StopValue = 1</p>
<p>Function ListEmpty {<br>
Param ($infolder)<br>
Foreach ($fldr in $infolder.Folders) {</p>
<p>If ($fldr.Items.Count -eq 0 -and $fldr.Folders.Count -eq 0) {</p>
<h1 id="i-have-had-to-check-for-system-folders-these-cannot-be-deleted-via-the-script-so-to-prevent-the-script-for-erroring-out-i-check-for-it">I have had to check for system folders, these cannot be deleted via the script, so to prevent the script for erroring out, I check for it.</h1>
<p>if ($fldr.name -match &ldquo;Slettet&rdquo; -or $fldr.name -match &ldquo;Deleted&rdquo; -or $fldr.name -match &ldquo;journal&rdquo; -or $fldr.name -match &ldquo;rss&rdquo;<code>-or $fldr.name -match &quot;note&quot; -or $fldr.name -match &quot;kalender&quot; -or $fldr.name -match &quot;kontakt&quot; -or $fldr.name -match &quot;udbakke&quot; </code><br>
-or $fldr.name -match &ldquo;Sync&rdquo; -or $fldr.name -match &ldquo;Server&rdquo; -or $fldr.name -match &ldquo;contacts&rdquo; -or $fldr.name -match &ldquo;Outbox&rdquo; )<br>
{&ldquo;Cannot delete systemfolder : &quot;&rdquo;&quot; + $fldr.FolderPath + &quot;&quot;</p>
<p>}</p>
<p>Else {<br>
if ($fldr.Parent.name -notmatch &ldquo;slettet&rdquo; -and $fldr.Parent.name -notmatch &ldquo;Deleted&rdquo; ) {<br>
#Remove # from the below line, to actually delete Outlook folders.<br>
#$fldr.delete()<br>
$fldr.FolderPath + &quot; has been deleted!!&quot;</p>
<p>$Global:StopValue = 0<br>
}<br>
}<br>
}</p>
<p>Else {<br>
if ($fldr.name.length -gt 0) {</p>
<p>ListEmpty($fldr)}<br>
}</p>
<p>}</p>
<p>}</p>
<p>$RootFolders = $namespace.Folders | ?{$_.name -match $RootfolderToMatch}</p>
<p>Listempty($RootFolders)</p>
<p>While ($Global:StopValue -eq 0) {<br>
$Global:StopValue = 1<br>
Listempty($RootFolders)<br>
}</p>
<p>[/ps]</p>
<p>I start by initializing the Outlook COM object, and declaring some variables<br>
[ps]<br>
$olApp = new-object -com Outlook.Application<br>
$namespace = $olApp.GetNamespace(&ldquo;MAPI&rdquo;)<br>
#Root folder to match, look in your outlook and look at what folders you have.<br>
#RooFolders could be Mailbox - &lt;/username&gt;&lt;username&gt;, Public folders, or other mapped in PST&rsquo;s or mailboxes.<br>
$RootfolderToMatch = &ldquo;Inbox&rdquo;</p>
<p>$Global:StopValue = 1<br>
[/ps]</p>
<p>I then create a function that takes an Outlook folder as a parameter.<br>
I then loop through each subfolder, and checks to see if each folder contains any files or other folders, if it finds a folder that does not contain any files/folders it then checks to see if the folder name is something like &ldquo;outbox, sent items, Journal etc etc.&rdquo; The reason I do this is because these are system folders, and cannot be deleted, so if the script tried to delete one of them, it would come back with an error.</p>
<p>So if the folder that is currently being checked is empty and is not a system folder it will be deleted.(Actually the line where the folder is deleted is commented out, just to make sure there is not accidental deletions) The script then recurses through all subfolders to check for empty folders.</p>
<p>[ps]</p>
<p>Function ListEmpty {<br>
Param ($infolder)<br>
Foreach ($fldr in $infolder.Folders) {</p>
<p>If ($fldr.Items.Count -eq 0 -and $fldr.Folders.Count -eq 0) {</p>
<h1 id="i-have-had-to-check-for-system-folders-these-cannot-be-deleted-via-the-script-so-to-prevent-the-script-for-erroring-out-i-check-for-it-1">I have had to check for system folders, these cannot be deleted via the script, so to prevent the script for erroring out, I check for it.</h1>
<p>if ($fldr.name -match &ldquo;Slettet&rdquo; -or $fldr.name -match &ldquo;Deleted&rdquo; -or $fldr.name -match &ldquo;journal&rdquo; -or $fldr.name -match &ldquo;rss&rdquo;<code>-or $fldr.name -match &quot;note&quot; -or $fldr.name -match &quot;kalender&quot; -or $fldr.name -match &quot;kontakt&quot; -or $fldr.name -match &quot;udbakke&quot; </code><br>
-or $fldr.name -match &ldquo;Sync&rdquo; -or $fldr.name -match &ldquo;Server&rdquo; -or $fldr.name -match &ldquo;contacts&rdquo; -or $fldr.name -match &ldquo;Outbox&rdquo; )<br>
{&ldquo;Cannot delete systemfolder : &quot;&rdquo;&quot; + $fldr.FolderPath + &quot;&quot;</p>
<p>}</p>
<p>Else {<br>
if ($fldr.Parent.name -notmatch &ldquo;slettet&rdquo; -and $fldr.Parent.name -notmatch &ldquo;Deleted&rdquo; ) {<br>
#Remove # from the below line, to actually delete Outlook folders.<br>
#$fldr.delete()<br>
$fldr.FolderPath + &quot; has been deleted!!&quot;</p>
<p>$Global:StopValue = 0<br>
}<br>
}<br>
}</p>
<p>Else {<br>
if ($fldr.name.length -gt 0) {</p>
<p>ListEmpty($fldr)}<br>
}</p>
<p>}</p>
<p>}</p>
<p>[/PS]</p>
<p>Rootfolders is the initial &ldquo;path&rdquo;/folder that the scripts starts to look for empty folders from.<br>
$namespace.folders is the highest folder level in Outlook, it contains the user mailbox, public folders and any mapped in .pst files, so what I do here is match a single top level folder.</p>
<p>Here is an example, lets say I have opened a .pst file called BusinessCases09, I would set $RootfolderToMatch equal to &lt;em&gt;BusinessCases09&lt;/em&gt; (This is set at the beginning of the script), that means when the ListEmpty function is called for the first time, it will scan through all subfolders of the .pst file.<br>
[ps]</p>
<p>$RootFolders = $namespace.Folders | ?{$_.name -match $RootfolderToMatch}</p>
<p>Listempty($RootFolders)</p>
<p>[/ps]</p>
<p>In order to make sure the script runs to all empty folders is deleted, I have set up a while loop to call function until no more empty folders are found.<br>
[ps]<br>
While ($Global:StopValue -eq 0) {<br>
$Global:StopValue = 1<br>
Listempty($RootFolders)<br>
[/ps]</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/2009-03-11-get-mailboxinfo-powershell-script/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Get-Mailboxinfo Powershell script</span>
    </a>
    
    
    <a href="/posts/2009-04-17-arrived-safely-in-washington-dulles-airport/" class="navigation-next">
      <span class="navigation-tittle">Arrived safely in Washington Dulles airport</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'xipher-1';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" integrity="sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/powershell.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/sql.min.js"></script>
            
        
    <script type="text/javascript">
        
        hljs.configure({languages: ["powershell, sql"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
